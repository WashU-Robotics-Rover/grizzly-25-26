<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRIZZLY // COMMAND</title>
    
    <!-- Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Load roslib.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/roslib@1/build/roslib.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap');
        body { font-family: 'JetBrains Mono', monospace; }
        
        /* Tab Styles */
        .tab-button.active {
            border-bottom-color: #3b82f6;
            color: #60a5fa;
        }
        
        .tab-content {
            animation: fadeIn 0.2s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Terminal Styles */
        #terminalContainer {
            scrollbar-width: thin;
            scrollbar-color: #3f3f46 #18181b;
        }
        
        #terminalContainer::-webkit-scrollbar {
            width: 8px;
        }
        
        #terminalContainer::-webkit-scrollbar-track {
            background: #18181b;
        }
        
        #terminalContainer::-webkit-scrollbar-thumb {
            background: #3f3f46;
            border-radius: 4px;
        }
        
        #terminalContainer::-webkit-scrollbar-thumb:hover {
            background: #52525b;
        }
        
        .terminal-line {
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        
        /* Filter button states */
        .filter-button:not(.active) {
            opacity: 0.3;
            border-color: #3f3f46 !important;
            color: #71717a !important;
        }
    </style>
</head>
<body class="bg-black min-h-screen text-gray-100 antialiased">
    
    <div class="container mx-auto px-4 py-4 max-w-7xl">
        
        <!-- Header -->
        <header class="bg-zinc-950 border-b border-zinc-800 mb-4 pb-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="text-2xl">üêª</div>
                    <div class="flex items-center gap-3">
                        <h1 class="text-xl font-bold text-white tracking-wider">GRIZZLY</h1>
                        <span class="text-zinc-600">//</span>
                        <span class="text-sm text-zinc-400 uppercase tracking-wide">Command Interface</span>
                    </div>
                </div>
                <div class="flex items-center gap-2 text-xs">
                    <span id="connectionIndicator" class="w-2 h-2 rounded-full bg-red-500"></span>
                    <span id="connectionStatus" class="text-red-400 font-mono uppercase tracking-wider">OFFLINE</span>
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="bg-zinc-950 border-b border-zinc-800 mb-3">
            <div class="flex gap-1">
                <button id="tabSystemMgmt" onclick="switchTab('system-management')" 
                        class="tab-button active px-4 py-2 text-xs font-mono uppercase tracking-wider border-b-2 border-blue-500 text-blue-400 transition-all">
                    [SYSTEM MANAGEMENT]
                </button>
                <button id="tabOutput" onclick="switchTab('output')" 
                        class="tab-button px-4 py-2 text-xs font-mono uppercase tracking-wider border-b-2 border-transparent text-zinc-500 hover:text-zinc-300 transition-all">
                    [OUTPUT]
                </button>
            </div>
        </div>

        <!-- Tab Content: System Management -->
        <div id="tab-system-management" class="tab-content">
        <!-- Main Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-3 mb-3">
            
            <!-- Operational State Panel -->
            <div class="bg-zinc-950 border border-zinc-800 p-4">
                <div class="flex items-center justify-between mb-3 pb-2 border-b border-zinc-800">
                    <h2 class="text-xs font-semibold text-zinc-400 uppercase tracking-wider">System State</h2>
                    <div class="w-1 h-1 bg-blue-500 rounded-full animate-pulse"></div>
                </div>
                
                <!-- State Badge -->
                <div id="stateBadge" class="bg-zinc-900 border border-zinc-800 p-6 mb-3">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-white mb-1 tracking-wide" id="stateName">UNKNOWN</div>
                        <div class="text-[10px] text-zinc-500 uppercase tracking-widest">Operational Mode</div>
                    </div>
                </div>
                
                <!-- State Info -->
                <div class="space-y-1 text-xs font-mono">
                    <div class="flex justify-between py-1.5 border-b border-zinc-900">
                        <span class="text-zinc-500">DESC</span>
                        <span class="text-zinc-300" id="stateDescription">---</span>
                    </div>
                    <div class="flex justify-between py-1.5 border-b border-zinc-900">
                        <span class="text-zinc-500">UPDATED</span>
                        <span class="text-zinc-300" id="stateTimestamp">--</span>
                    </div>
                    <div class="flex justify-between py-1.5">
                        <span class="text-zinc-500">VALUE</span>
                        <span class="text-blue-400" id="stateValue">--</span>
                    </div>
                </div>
            </div>

            <!-- Health Status Panel -->
            <div class="bg-zinc-950 border border-zinc-800 p-4">
                <div class="flex items-center justify-between mb-3 pb-2 border-b border-zinc-800">
                    <h2 class="text-xs font-semibold text-zinc-400 uppercase tracking-wider">Health Monitor</h2>
                    <div class="w-1 h-1 bg-green-500 rounded-full animate-pulse"></div>
                </div>
                
                <div class="bg-zinc-900 border border-zinc-800 p-3 mb-3">
                    <p class="text-xs text-zinc-300 font-mono" id="healthMessage">WAITING FOR DATA...</p>
                </div>
                
                <div class="text-[10px] text-zinc-500 font-mono uppercase tracking-wider">
                    <span>LAST: </span>
                    <span id="healthTimestamp" class="text-zinc-400">--</span>
                </div>
            </div>

            <!-- ROS Bridge Settings -->
            <div class="bg-zinc-950 border border-zinc-800 p-4">
                <div class="flex items-center justify-between mb-3 pb-2 border-b border-zinc-800">
                    <h2 class="text-xs font-semibold text-zinc-400 uppercase tracking-wider">Connection</h2>
                    <div class="w-1 h-1 bg-purple-500 rounded-full animate-pulse"></div>
                </div>
                
                <input type="text" id="rosBridgeUrl" value="ws://localhost:9090" 
                       class="w-full bg-zinc-900 border border-zinc-800 px-3 py-2 text-xs text-zinc-300 font-mono focus:outline-none focus:border-blue-600 transition-colors mb-2" />
                
                <button onclick="reconnect()" 
                        class="w-full bg-zinc-900 hover:bg-zinc-800 border border-zinc-800 hover:border-zinc-700 text-zinc-300 text-xs font-mono uppercase tracking-wider py-2 transition-all mb-2">
                    [RECONNECT]
                </button>
                
                <div class="text-[10px] font-mono uppercase tracking-wider">
                    <span class="text-zinc-600">SERVICE:</span> 
                    <span id="serviceReady" class="text-red-500">NOT READY</span>
                </div>
            </div>

        </div>

        <!-- State Controls Panel -->
        <div class="bg-zinc-950 border border-zinc-800 p-4 mb-3">
            <div class="flex items-center justify-between mb-3 pb-2 border-b border-zinc-800">
                <h2 class="text-xs font-semibold text-zinc-400 uppercase tracking-wider">State Control</h2>
                <div class="w-1 h-1 bg-yellow-500 rounded-full animate-pulse"></div>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-2">
                <button onclick="requestStateChange(1, 'User requested STANDBY')" 
                        class="bg-zinc-900 hover:bg-blue-600 border border-zinc-800 hover:border-blue-600 text-zinc-300 hover:text-white font-mono text-xs uppercase tracking-wider py-3 transition-all">
                    [STANDBY]
                </button>
                
                <button onclick="requestStateChange(2, 'User requested AUTONOMOUS')" 
                        class="bg-zinc-900 hover:bg-green-600 border border-zinc-800 hover:border-green-600 text-zinc-300 hover:text-white font-mono text-xs uppercase tracking-wider py-3 transition-all">
                    [AUTONOMOUS]
                </button>
                
                <button onclick="requestStateChange(3, 'User requested MANUAL')" 
                        class="bg-zinc-900 hover:bg-yellow-600 border border-zinc-800 hover:border-yellow-600 text-zinc-300 hover:text-white font-mono text-xs uppercase tracking-wider py-3 transition-all">
                    [MANUAL]
                </button>
                
                <button onclick="requestStateChange(4, 'User triggered EMERGENCY')" 
                        class="bg-zinc-900 hover:bg-red-600 border border-zinc-800 hover:border-red-600 text-zinc-300 hover:text-white font-mono text-xs uppercase tracking-wider py-3 transition-all animate-pulse">
                    [EMERGENCY]
                </button>
            </div>
            
            <div id="serviceResponse" class="hidden mt-2 p-2 border text-xs font-mono"></div>
        </div>

        <!-- State History Panel -->
        <div class="bg-zinc-950 border border-zinc-800 p-4">
            <div class="flex items-center justify-between mb-3 pb-2 border-b border-zinc-800">
                <h2 class="text-xs font-semibold text-zinc-400 uppercase tracking-wider">Event Log</h2>
                <div class="w-1 h-1 bg-green-500 rounded-full"></div>
            </div>
            
            <div class="bg-black border border-zinc-900 overflow-hidden">
                <div class="max-h-64 overflow-y-auto custom-scrollbar">
                    <ul id="stateHistory" class="divide-y divide-zinc-900">
                        <li class="p-2 text-xs font-mono text-zinc-600">// NO EVENTS LOGGED</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- System Info Panel -->
        <div class="bg-zinc-950 border border-zinc-800 p-4">
            <div class="flex items-center justify-between mb-3 pb-2 border-b border-zinc-800">
                <h2 class="text-xs font-semibold text-zinc-400 uppercase tracking-wider">State Reference</h2>
                <div class="w-1 h-1 bg-zinc-600 rounded-full"></div>
            </div>
            
            <div class="grid grid-cols-2 gap-2 text-xs font-mono">
                <div class="flex items-center gap-2 text-zinc-500"><span class="bg-zinc-800 px-2 py-1 text-zinc-400">0</span> STARTUP</div>
                <div class="flex items-center gap-2 text-zinc-500"><span class="bg-blue-900 px-2 py-1 text-blue-300">1</span> STANDBY</div>
                <div class="flex items-center gap-2 text-zinc-500"><span class="bg-green-900 px-2 py-1 text-green-300">2</span> AUTONOMOUS</div>
                <div class="flex items-center gap-2 text-zinc-500"><span class="bg-yellow-900 px-2 py-1 text-yellow-300">3</span> MANUAL</div>
                <div class="flex items-center gap-2 text-zinc-500"><span class="bg-red-900 px-2 py-1 text-red-300">4</span> EMERGENCY</div>
                <div class="flex items-center gap-2 text-zinc-500"><span class="bg-red-950 px-2 py-1 text-red-400">5</span> ERROR</div>
                <div class="flex items-center gap-2 text-zinc-500"><span class="bg-black px-2 py-1 text-zinc-500 border border-zinc-800">6</span> SHUTDOWN</div>
                <div class="flex items-center gap-2 text-zinc-500"><span class="bg-yellow-900 px-2 py-1 text-yellow-300 border-2 border-yellow-500">??</span> UNKNOWN</div>
            </div>
        </div>

        </div>
        <!-- End Tab Content: System Management -->

        <!-- Tab Content: Output -->
        <div id="tab-output" class="tab-content hidden">
            
            <!-- Terminal Output Panel -->
            <div class="bg-zinc-950 border border-zinc-800 mb-3">
                <div class="flex items-center justify-between px-4 py-2 border-b border-zinc-800">
                    <h2 class="text-xs font-semibold text-zinc-400 uppercase tracking-wider">ROS Output Terminal</h2>
                    <div class="flex items-center gap-2">
                        <button onclick="TerminalOutput.clear()" 
                                class="text-[10px] font-mono text-zinc-500 hover:text-zinc-300 uppercase tracking-wider px-2 py-1 border border-zinc-800 hover:border-zinc-700 transition-all">
                            [CLEAR]
                        </button>
                        <button onclick="TerminalOutput.toggleAutoscroll()" 
                                class="text-[10px] font-mono text-zinc-500 hover:text-zinc-300 uppercase tracking-wider px-2 py-1 border border-zinc-800 hover:border-zinc-700 transition-all">
                            <span id="autoscrollIndicator">[AUTO-SCROLL: ON]</span>
                        </button>
                        <div class="w-1 h-1 bg-green-500 rounded-full animate-pulse"></div>
                    </div>
                </div>
                
                <!-- Terminal Display -->
                <div id="terminalContainer" class="bg-black p-2 font-mono text-xs h-[600px] overflow-y-auto custom-scrollbar">
                    <div id="terminalOutput">
                        <div class="text-zinc-600">// Waiting for ROS output...</div>
                    </div>
                </div>
                
                <!-- Terminal Stats -->
                <div class="px-4 py-2 border-t border-zinc-800 flex items-center justify-between text-[10px] font-mono">
                    <div class="text-zinc-500">
                        <span>MESSAGES: </span>
                        <span id="terminalMessageCount" class="text-zinc-400">0</span>
                        <span class="ml-3">NODES: </span>
                        <span id="terminalNodeCount" class="text-zinc-400">0</span>
                    </div>
                    <div class="text-zinc-500">
                        <span>DEBUG: </span><span id="terminalDebugCount" class="text-blue-400">0</span>
                        <span class="ml-2">INFO: </span><span id="terminalInfoCount" class="text-green-400">0</span>
                        <span class="ml-2">WARN: </span><span id="terminalWarnCount" class="text-yellow-400">0</span>
                        <span class="ml-2">ERROR: </span><span id="terminalErrorCount" class="text-red-400">0</span>
                        <span class="ml-2">FATAL: </span><span id="terminalFatalCount" class="text-red-500">0</span>
                    </div>
                </div>
            </div>

            <!-- Filter Controls -->
            <div class="bg-zinc-950 border border-zinc-800 p-4 mb-3">
                <div class="flex items-center justify-between mb-3 pb-2 border-b border-zinc-800">
                    <h2 class="text-xs font-semibold text-zinc-400 uppercase tracking-wider">Output Filters</h2>
                    <div class="w-1 h-1 bg-purple-500 rounded-full"></div>
                </div>
                
                <!-- Log Level Filters -->
                <div class="mb-3">
                    <label class="text-[10px] text-zinc-500 font-mono uppercase tracking-wider mb-1 block">Log Levels</label>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-2">
                        <button onclick="TerminalOutput.toggleLevel('DEBUG')" id="filterDebug"
                                class="filter-button active bg-zinc-900 border border-blue-600 text-blue-400 font-mono text-xs uppercase tracking-wider py-2 transition-all">
                            [DEBUG]
                        </button>
                        <button onclick="TerminalOutput.toggleLevel('INFO')" id="filterInfo"
                                class="filter-button active bg-zinc-900 border border-green-600 text-green-400 font-mono text-xs uppercase tracking-wider py-2 transition-all">
                            [INFO]
                        </button>
                        <button onclick="TerminalOutput.toggleLevel('WARN')" id="filterWarn"
                                class="filter-button active bg-zinc-900 border border-yellow-600 text-yellow-400 font-mono text-xs uppercase tracking-wider py-2 transition-all">
                            [WARN]
                        </button>
                        <button onclick="TerminalOutput.toggleLevel('ERROR')" id="filterError"
                                class="filter-button active bg-zinc-900 border border-red-600 text-red-400 font-mono text-xs uppercase tracking-wider py-2 transition-all">
                            [ERROR]
                        </button>
                        <button onclick="TerminalOutput.toggleLevel('FATAL')" id="filterFatal"
                                class="filter-button active bg-zinc-900 border border-red-800 text-red-500 font-mono text-xs uppercase tracking-wider py-2 transition-all">
                            [FATAL]
                        </button>
                    </div>
                </div>
                
                <!-- Node Filter -->
                <div>
                    <label class="text-[10px] text-zinc-500 font-mono uppercase tracking-wider mb-1 block">Node Filter</label>
                    <select id="nodeFilterSelect" 
                            onchange="TerminalOutput.setNodeFilter(this.value || null)"
                            class="w-full bg-zinc-900 border border-zinc-800 text-zinc-300 font-mono text-xs py-2 px-3 focus:outline-none focus:border-blue-600 transition-colors">
                        <option value="">ALL NODES</option>
                    </select>
                </div>
            </div>

        </div>
        <!-- End Tab Content: Output -->

        <!-- Footer -->
        <footer class="mt-3 text-center text-xs text-zinc-600 font-mono border-t border-zinc-900 pt-3">
            <p>GRIZZLY ¬© 2025 // WASHU ROBOTICS</p>
        </footer>
        
    </div>

    <!-- Load modular application JavaScript -->
    <!-- Core configuration must load first -->
    <script src="js/core/config.js"></script>
    
    <!-- Utilities -->
    <script src="js/utils/helpers.js"></script>
    
    <!-- UI Modules -->
    <script src="js/ui/notifications.js"></script>
    <script src="js/ui/state-display.js"></script>
    <script src="js/ui/health-display.js"></script>
    <script src="js/ui/history.js"></script>
    <script src="js/ui/tab-manager.js"></script>
    <script src="js/ui/terminal-output.js"></script>
    
    <!-- Monitoring -->
    <script src="js/monitoring/health-monitor.js"></script>
    
    <!-- ROS Interface -->
    <script src="js/ros/connection.js"></script>
    <script src="js/ros/subscribers.js"></script>
    <script src="js/ros/services.js"></script>
    
    <!-- Main application (loads last) -->
    <script src="js/main.js"></script>
    
</body>
</html>
